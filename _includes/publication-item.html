{% comment %} Check if work title ends with ? or ! {% endcomment %}
{% capture work_title_slice %}{{ publication.work_title | slice: -1, 1 }}{% endcapture %}
{% if "?!" contains work_title_slice %}
  {% assign work_title_special_punct_tf = true %}
{% else %}
  {% assign work_title_special_punct_tf = false %}
{% endif %}

{% assign chatlab_baseurl = "http://ccn.upenn.edu/chatterjee" %}
{% capture citation_start %}{% if publication.pdf and publication.pdf != "" %}<a class="link blue dim" href="{{ publication.pdf | prepend: chatlab_baseurl }}" target="_blank">{{ publication.work_authors }} ({{ publication.work_year }})</a>{% else %}{{ publication.work_authors }} ({{ publication.work_year }}){% endif %}. <cite class="fs-normal">{{ publication.work_title }}</cite>{% endcapture %}

{% case publication.work_publication_format %}
{% comment %} Note: using .overflow-hidden to cut off a few long DOIs on small screen {% endcomment %}
  {% when "article_in_journal" %}
    <p class="f5 f4-ns hanging-indent overflow-hidden mb3">{{ citation_start }}{% if publication.review %} [{% case publication.review_type %}{% when "review" %}Review of{% when "commentary" %}Commentary on{% endcase %} the {{ publication.reviewed_work_type }} <cite>{{ publication.reviewed_work_title}}</cite>, by {{ publication.reviewed_work_author }}]<!-- endif for review -->{% endif %}{% unless work_title_special_punct_tf %}.<!-- endunless for work_title_special_punct_tf -->{% endunless %} <i>{{ publication.journal_title }}{% if publication.journal_advance %}</i>. Advance online publication{% elsif publication.journal_preprint %}</i>. Preprint{% else %}, {{ publication.journal_vol }}</i>{% if publication.journal_issue != null %}({{ publication.journal_issue }})<!-- endif for journal_issue != null -->{% endif %}, {{ publication.journal_pages_start }}{% unless publication.journal_pages_stop == publication.journal_pages_start %}-{{ publication.journal_pages_stop }}{% endunless %}<!-- endif for journal_advance -->{% endif %}. {% if publication.work_doi != null %}<a class="link blue dim" href="https://doi.org/{{ publication.work_doi }}" target="_blank">doi: {{ publication.work_doi }}</a><!-- endif journal_doi != null -->{% endif %}{% if publication.link_name %}<br /><span class="mr1">↳</span> <a class="link blue dim" href="{{ publication.link_url | prepend: chatlab_baseurl }}">{{ publication.link_name }}</a>{% endif %}</p>
  {% when "article_in_edited_work" %}
    <p class="f5 f4-ns hanging-indent overflow-hidden mb3">{{ citation_start }}{% unless work_title_special_punct_tf %}.{% endunless %} In {{ publication.edited_work_editors }}, <cite>{{ publication.edited_work_title }}</cite> (pp. {{ publication.edited_work_pages_start }}-{{ publication.edited_work_pages_stop }}). {{ publication.edited_work_location }}: {{ publication.edited_work_publisher }}.{% if publication.link_name %}<br /><span class="mr1">↳</span> <a class="link blue dim" href="{{ publication.link_url | prepend: chatlab_baseurl }}">{{ publication.link_name }}</a>{% endif %}</p>
{% endcase %}
